// Inside the input event listener for telNumberInput
let value = telNumberInput.value.replace(/[^\d+]/g, ''); // Remove non-digits, allow leading +
let formattedValue = '';
let cursorPosition = telNumberInput.selectionStart;
const oldValueLength = telNumberInput.value.length;

const hasPlus = value.startsWith('+');
if (hasPlus) {
    formattedValue += '+';
    value = value.substring(1); // Process digits after +
    cursorPosition--; // Adjust cursor based on '+'
}

const pureDigits = value.replace(/\D/g, ''); // Get only digits after potential +
let tempDigits = pureDigits;

if (tempDigits.length > 0) {
    formattedValue += tempDigits.substring(0, Math.min(3, tempDigits.length));
    if (tempDigits.length > 3) {
        formattedValue += '-';
        cursorPosition++; // Adjust for dash
        tempDigits = tempDigits.substring(3);

        if (tempDigits.length > 0) {
            formattedValue += tempDigits.substring(0, Math.min(3, tempDigits.length));
            if (tempDigits.length > 3) {
                 formattedValue += '-';
                 cursorPosition++; // Adjust for dash
                 tempDigits = tempDigits.substring(3);

                 if (tempDigits.length > 0) {
                     formattedValue += tempDigits.substring(0, Math.min(4, tempDigits.length));
                     // No more dashes
                 }
            }
        }
    }
}

telNumberInput.value = formattedValue;

// Try to restore cursor position
const newValueLength = telNumberInput.value.length;
const lengthDiff = newValueLength - oldValueLength;
const newCursorPosition = cursorPosition + lengthDiff;
telNumberInput.setSelectionRange(newCursorPosition, newCursorPosition);


// --- Validation Logic ---
// Check if the cleaned value (digits + potential leading +) has at least 10 digits after the +
const cleanedForValidation = telNumberInput.value.replace(/[^\d+]/g, '');
let digitCount = cleanedForValidation.replace(/\+/g, '').length; // Count digits, ignore +

const isTelFormatValid = digitCount >= 10; // Minimum 10 digits needed


// Update checkFormValidity()
function checkFormValidity() {
    const isNameFilled = userNameInput.value.trim() !== '';
    // Use the isTelFormatValid flag calculated in the input handler
    return isNameFilled && isTelFormatValid;
}

// Call checkFormValidity to update button state
proceedButton.disabled = !checkFormValidity();
